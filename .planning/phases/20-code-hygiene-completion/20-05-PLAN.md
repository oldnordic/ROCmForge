---
phase: 20-code-hygiene-completion
plan: 05
type: execute
wave: 2
depends_on: ["20-01", "20-02", "20-03"]
files_modified:
  - src/attention/multi_query.rs
  - src/profiling/ttft.rs
  - src/ggml/hip_backend/ops/q4_0_dequant.rs
autonomous: true
user_setup: []

must_haves:
  truths:
    - "All unused mut variable warnings are eliminated"
    - "Unused assignment warning eliminated"
    - "Privacy warning resolved"
  artifacts:
    - path: "src/attention/multi_query.rs"
      provides: "Removed unnecessary mut from variables"
      contains: "no variable does not need to be mutable warnings"
    - path: "src/profiling/ttft.rs"
      provides: "Fixed unused max_time assignment"
      contains: "either used or removed"
    - path: "src/ggml/hip_backend/ops/q4_0_dequant.rs"
      provides: "Fixed Q4_0DequantCache privacy"
      contains: "pub struct or private fn"
  key_links:
    - from: "unused mut variables"
      to: "immutable declarations"
      via: "remove mut keyword"
      pattern: "let mut.*=.*;"
---

<objective>
Fix unused mut, unused assignment, and remaining privacy warnings.

Purpose: These are simple hygiene fixes - removing unnecessary mut keywords and handling unused assignments. The privacy warning for Q4_0DequantCache should be addressed here.

Output: 5 remaining simple warnings eliminated.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
</context>

<tasks>

<task type="auto">
  <name>Fix unused mut variables in multi_query.rs</name>
  <files>src/attention/multi_query.rs</files>
  <action>
    Read src/attention/multi_query.rs around lines 311 and 341.
    For each "variable does not need to be mutable" warning:
    1. Read the context to confirm the variable is never modified
    2. Remove the mut keyword from the variable declaration
    3. Verify the code still compiles

    Locations:
    - Line 311: some variable
    - Line 341: some variable
  </action>
  <verify>grep -n "does not need to be mutable" &lt;(cargo check --features rocm 2>&1) returns no results</verify>
  <done>Both unused mut warnings fixed</done>
</task>

<task type="auto">
  <name>Fix unused max_time assignment in ttft.rs</name>
  <files>src/profiling/ttft.rs</files>
  <action>
    Read src/profiling/ttft.rs around line 178.
    The variable max_time is assigned but never read.
    Options:
    1. Remove the assignment entirely if the value is not needed
    2. Add an underscore prefix: let _max_time = ... to intentionally ignore
    3. Use the value somewhere if it was intended to be used

    Based on the context, determine the appropriate fix.
    If it's for a future feature or debugging, use _max_time.
    If it's truly unused, remove the assignment.
  </action>
  <verify>grep -n "value assigned.*is never read" &lt;(cargo check --features rocm 2>&1) returns no results for max_time</verify>
  <done>max_time assignment warning resolved</done>
</task>

<task type="auto">
  <name>Fix Q4_0DequantCache privacy warning</name>
  <files>src/ggml/hip_backend/ops/q4_0_dequant.rs</files>
  <action>
    This warning was identified in plan 02 but not fixed there.
    Read src/ggml/hip_backend/ops/q4_0_dequant.rs around line 45.
    The struct Q4_0DequantCache is private but the function get_or_init_q4_0_dequant_cache is public.
    Since the function returns a reference to this struct, the struct must be at least as visible as the function.

    Change: `struct Q4_0DequantCache` to `pub struct Q4_0DequantCache`
  </action>
  <verify>grep -n "is more private" &lt;(cargo check --features rocm 2>&1) returns no results</verify>
  <done>Q4_0DequantCache visibility matches accessor</done>
</task>

<task type="auto">
  <name>Verify all simple hygiene warnings fixed</name>
  <files></files>
  <action>
    Run cargo check --features rocm.
    Verify no "does not need to be mutable" warnings.
    Verify no "is never read" warnings for assignments.
    Verify no "is more private" warnings.
    Count remaining warnings (should be 39, down from 44).
  </action>
  <verify>grep -E "does not need to be mutable|is never read|is more private" &lt;(cargo check --features rocm 2>&1) returns no results</verify>
  <done>HYGIENE-05 requirement satisfied</done>
</task>

</tasks>

<verification>
1. Read src/attention/multi_query.rs and confirm no unnecessary mut keywords
2. Read src/profiling/ttft.rs and confirm max_time is handled correctly
3. Read src/ggml/hip_backend/ops/q4_0_dequant.rs and confirm Q4_0DequantCache is pub
4. Run cargo check --features rocm and verify no simple hygiene warnings
</verification>

<success_criteria>
- Zero "does not need to be mutable" warnings (was 2, now 0)
- Zero "value assigned is never read" warnings (was 1, now 0)
- Zero "is more private" warnings (was 1, now 0)
- Total warning count reduced from 44 to 39
- HYGIENE-05 requirement satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/20-code-hygiene-completion/20-05-SUMMARY.md`
</output>
