---
phase: 20-code-hygiene-completion
plan: 07
type: execute
wave: 3
depends_on: ["20-04", "20-05"]
files_modified:
  - src/backend/hip_backend/backend.rs
  - src/loader/gguf.rs
  - src/model/execution_plan/execution_plan_src.rs
  - src/attention/mod.rs
  - src/attention/multi_query.rs
  - src/kv_cache/mod.rs
  - src/scheduler/mod.rs
autonomous: true
user_setup: []

must_haves:
  truths:
    - "All unused functions and methods are reviewed"
    - "All unused constants and type aliases are reviewed"
    - "Dead code either removed or justified with comments"
  artifacts:
    - path: "src/loader/gguf.rs"
      provides: "Reviewed unused functions and constants"
      contains: "either used, removed, or #[allow(dead_code)] with comment"
    - path: "src/attention/mod.rs"
      provides: "Reviewed unused methods"
      contains: "either used, removed, or #[allow(dead_code)] with comment"
  key_links:
    - from: "unused functions"
      to: "actual usage or removal"
      via: "grep search and review"
      pattern: "fn.*never used"
---

<objective>
Review and fix unused functions, methods, constants, and type aliases.

Purpose: Second of three plans to resolve dead_code warnings. This plan handles unused functions, methods, constants, and type aliases across all affected files.

Output: Unused functions and constants resolved or justified.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
</context>

<tasks>

<task type="auto">
  <name>Review and fix unused functions and methods</name>
  <files>
    src/backend/hip_backend/backend.rs
    src/loader/gguf.rs
    src/model/execution_plan/execution_plan_src.rs
    src/attention/mod.rs
    src/attention/multi_query.rs
    src/kv_cache/mod.rs
    src/scheduler/mod.rs
  </files>
  <action>
    For each "function/method X is never used" warning:
    1. Search for any usage with grep -r "function_name" src/
    2. If truly unused:
       - If it's a public API for external use, keep it
       - If it's obsolete, remove it
       - If it's for future work, add #[allow(dead_code)] with TODO
    3. If used via trait or dynamic dispatch, add #[allow(dead_code)] with justification

    Affected items (from warning analysis):
    - vec_from_buffer (backend.rs)
    - validate_input_shapes (attention/mod.rs)
    - record_retry_attempt (scheduler/mod.rs)
    - token_to_text (somewhere)
    - is_embedding_weight, read_tensor_data, upload_tensor_to_gpu, dequantize_mxfp4, dequantize_mxfp6 (gguf.rs)
    - from_bits, to_f32 (gguf.rs)
  </action>
  <verify>grep "is never used" &lt;(cargo check --features rocm 2>&1) | wc -l reduced or justified</verify>
  <done>All unused functions and methods reviewed and handled</done>
</task>

<task type="auto">
  <name>Review and fix unused constants and type aliases</name>
  <files>
    src/backend/hip_backend/backend.rs
    src/loader/gguf.rs
    src/ggml/hip_backend/mod.rs
  </files>
  <action>
    For each "constant/type alias X is never used" warning:
    1. Search for usage with grep
    2. If truly unused:
       - If it's part of a public API or for future features, keep with #[allow(dead_code)]
       - If it's obsolete, remove it
    3. For constants like PAGED_ATTENTION_KERNEL, HIP_EVENT_DEFAULT - these are likely for
       features not yet implemented; add #[allow(dead_code)] with TODO comments

    Affected items:
    - PAGED_ATTENTION_KERNEL
    - HIP_EVENT_DEFAULT
    - DEFAULT_LOG_LEVEL
    - Q4_0_BLOCK_SIZE, Q4_0_ELEMENTS_PER_BLOCK, Q8_0_ELEMENTS_PER_BLOCK
    - block_size, num_heads, head_dim (struct fields)
    - ParallelResult (type alias)
  </action>
  <verify>grep -E "constant.*is never used|type alias.*is never used" &lt;(cargo check --features rocm 2>&1) | wc -l reduced or justified</verify>
  <done>All unused constants and type aliases reviewed and handled</done>
</task>

</tasks>

<verification>
1. Run cargo check --features rocm and verify function/method warnings reduced
2. Run cargo check --features rocm and verify constant/type alias warnings reduced
3. Confirm all kept items have #[allow(dead_code)] with explanatory comments
</verification>

<success_criteria>
- All unused functions and methods reviewed (removed or justified)
- All unused constants and type aliases reviewed (removed or justified)
- Warning count significantly reduced
- All kept dead code has explanatory comments
</success_criteria>

<output>
After completion, create `.planning/phases/20-code-hygiene-completion/20-07-SUMMARY.md`
</output>
