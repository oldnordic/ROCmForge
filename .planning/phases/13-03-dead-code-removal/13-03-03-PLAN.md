---
phase: 13-03-dead-code-removal
plan: 03
type: execute
wave: 3
depends_on: [13-03-01, 13-03-02]
files_modified:
  - (multiple files across src/ and tests/)
autonomous: true

must_haves:
  truths:
    - "Compiler warning count reduced from ~404 to under 60"
    - "Unused imports removed across all source files"
    - "Unused variables removed or prefixed with underscore"
    - "Unnecessary mut keywords removed"
    - "cargo test --all-targets passes without errors"
  artifacts:
    - path: "src/"
      action: "bulk cleanup of unused imports and variables"
    - path: "tests/"
      action: "bulk cleanup of unused imports and variables"
  key_links:
    - from: "cargo check output"
      to: "cleaned codebase"
      via: "systematic warning resolution"
      pattern: "warning count reduction"
---

<objective>
Perform bulk cleanup of remaining compiler warnings: unused imports, unused variables, and unnecessary mut keywords.

Purpose: Reduce the remaining ~370 warnings (mostly unused imports and variables) to achieve the target of under 60 total warnings. This completes the compiler warning cleanup phase.

Output: Compiler warning count reduced from ~404 to under 60.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/13-03-dead-code-removal/13-03-CONTEXT.md
@.planning/phases/13-03-dead-code-removal/13-03-RESEARCH.md

# Research findings
Warning breakdown (404 total):
- ~200 unused imports (highest impact)
- ~100 unused variables
- ~35 mutable not needed
- ~31 deprecated copy_to_host (handled in plan 02)
- ~12 naming conventions (handled in plan 01)
- ~8 dead_code markers (handled in plan 01)
- ~3 deprecated ExecutionPlan::new (handled in plan 02)
- ~25 other/miscellaneous
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove unused imports in bulk</name>
  <files>(across src/ and tests/)</files>
  <action>
    Remove unused imports from all Rust source files. Use cargo fix where safe, then manually verify.

    Step 1: Run cargo fix for unused imports (automatic):
    ```bash
    cargo fix --lib --allow-dirty --allow-staged
    cargo fix --tests --allow-dirty --allow-staged
    ```

    Step 2: Verify the changes and check remaining warnings:
    ```bash
    cargo check --all-targets 2>&1 | grep "unused import" | head -20
    ```

    Step 3: For any remaining unused imports that cargo fix didn't handle, remove them manually:
    - Read the file
    - Identify the unused import from the warning
    - Remove the import line

    Focus on the most frequent unused imports identified in research:
    - `std::ffi::c_void` (6 occurrences)
    - `serial_test::serial` (5 occurrences)
    - `HipError` (5 occurrences)
    - `HipBackend` (4 occurrences)
    - `DeviceTensor` (4 occurrences)
    - `std::io::Write`, `std::collections::HashMap`, etc. (3 each)

    Commit message: "refactor(13-03-03): remove unused imports across codebase"
  </action>
  <verify>cargo check --all-targets 2>&1 | grep "unused import" | wc -l (should be <10)</verify>
  <done>Unused imports removed, warning count significantly reduced</done>
</task>

<task type="auto">
  <name>Task 2: Remove unused variables and unnecessary mut keywords</name>
  <files>(across src/ and tests/)</files>
  <action>
    Remove unused variables and unnecessary `mut` keywords.

    Step 1: Count current warnings for baseline:
    ```bash
    cargo check --all-targets 2>&1 | grep "unused variable" | wc -l
    cargo check --all-targets 2>&1 | grep "does not need to be mutable" | wc -l
    ```

    Step 2: For unused variables, either:
    a) Remove the variable entirely if it's not used
    b) Prefix the variable name with `_` if you want to keep it for future use
    c) Remove the `let` binding if the value is only used for a side effect

    Example transformations:
    ```rust
    // Unused - remove or prefix with underscore
    let backend = ...;  // unused
    let _backend = ...;  // explicitly ignored

    // Unnecessary mut - remove mut keyword
    let mut result = ...;  // never mutated
    let result = ...;  // correct
    ```

    Step 3: Focus on high-frequency warnings from research:
    - `backend` (8 occurrences)
    - `seq_len` (7 occurrences)
    - `output_shape`, `config`, `batch_size` (3 each)
    - ~35 "does not need to be mutable"

    Process systematically through files with the most warnings first.

    Commit message: "refactor(13-03-03): remove unused variables and unnecessary mut keywords"
  </action>
  <verify>cargo check --all-targets 2>&1 | grep -E "(unused variable|does not need to be mutable)" | wc -l (should be <20)</verify>
  <done>Unused variables removed, unnecessary mut keywords cleaned up</done>
</task>

<task type="auto">
  <name>Task 3: Fix remaining miscellaneous warnings</name>
  <files>(various)</files>
  <action>
    Address remaining warnings that don't fall into the above categories.

    First, check what warnings remain:
    ```bash
    cargo check --all-targets 2>&1 | grep "warning:" | sort | uniq -c | sort -rn | head -20
    ```

    Common categories to address:
    1. "value assigned to X is never read" - Remove the assignment or use the value
    2. "comparison is useless due to type limits" - Remove the impossible comparison
    3. "unexpected cfg condition value" - Fix or remove the cfg attribute

    For each category, systematically fix the occurrences.

    Commit message: "refactor(13-03-03): fix remaining miscellaneous compiler warnings"
  </action>
  <verify>TOTAL=$(cargo check --all-targets 2>&1 | grep -c "warning:"); echo "Total warnings: $TOTAL" (should be <60)</verify>
  <done>Total compiler warnings reduced to under 60</done>
</task>

<task type="auto">
  <name>Task 4: Verify test suite passes after cleanup</name>
  <files>(all files modified)</files>
  <action>
    Run full test suite to verify no functionality was broken during cleanup.

    Run: cargo test --all-targets

    If tests fail:
    1. Identify which test failed
    2. Check if a variable/import was incorrectly removed
    3. Restore the necessary code
    4. Re-run the specific test

    Common issues to watch for:
    - Test helper functions that are used but not detected by the compiler
    - Variables used only in assertions
    - Imports needed for trait implementations

    Commit message (if fixes needed): "fix(13-03-03): restore test code incorrectly removed during cleanup"
  </action>
  <verify>cargo test --all-targets (all tests pass)</verify>
  <done>Full test suite passes after cleanup</done>
</task>

</tasks>

<verification>
After all tasks complete, verify:
1. cargo check --all-targets 2>&1 | grep -c "warning:" returns <60
2. cargo test --all-targets passes without errors
3. No new #[allow(dead_code)] markers were added
4. No functionality was broken (all tests pass)
</verification>

<success_criteria>
- Total compiler warnings: <60 (from 404 baseline)
- Unused imports: minimal (<10 remaining)
- Unused variables: minimal (<20 remaining)
- All tests passing
- Phase success criteria met
</success_criteria>

<output>
After completion, create `.planning/phases/13-03-dead-code-removal/13-03-03-SUMMARY.md"
</output>
