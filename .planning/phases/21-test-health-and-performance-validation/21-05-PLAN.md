---
phase: 21-test-health-and-performance-validation
plan: 05
type: execute
wave: 4
depends_on: ["21-01", "21-02", "21-03", "21-04"]
files_modified: []
autonomous: false
user_setup: []

must_haves:
  truths:
    - "All lib tests pass (target: 572+ tests)"
    - "All integration tests pass"
    - "No SIGSEGV crashes during test execution"
    - "Tests can run to completion without timeout"
  artifacts:
    - path: "cargo test output"
      provides: "Passing test results"
  key_links:
    - from: "Phase 21-05"
      to: "All test files"
      via: "cargo test --features rocm"
---

<objective>
Run full test suite and verify all tests pass.

Purpose: After fixing individual test issues, run the complete test suite to ensure:
1. All lib tests pass (572+ tests as stated in requirements)
2. All integration tests pass
3. No segfaults or unexpected crashes
4. Tests complete within reasonable time

Output: Comprehensive test execution report showing all tests passing.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md

# Phase 21-01 through 21-04 summaries for context on fixes applied
@.planning/phases/21-test-health-and-performance-validation/21-01-SUMMARY.md
@.planning/phases/21-test-health-and-performance-validation/21-02-SUMMARY.md
@.planning/phases/21-test-health-and-performance-validation/21-03-SUMMARY.md
@.planning/phases/21-test-health-and-performance-validation/21-04-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete test suite execution covering:
    - Lib tests: cargo test --features rocm --lib
    - Integration tests: cargo test --features rocm --test '*'
    - Test count verification
    - Crash/segfault detection
  </what-built>
  <how-to-verify>
    Run the full test suite:
    ```bash
    # Run lib tests
    cargo test --features rocm --lib 2>&1 | tee test_output_lib.txt

    # Run integration tests
    cargo test --features rocm --test '*' 2>&1 | tee test_output_integration.txt

    # Check for failures
    grep -E "test result: FAILED|FAILED" test_output_*.txt || echo "No failures found"

    # Count total passing tests
    grep -E "test result: ok" test_output_*.txt | awk '{sum += $4} END {print sum}'
    ```

    Expected results:
    - All lib tests pass (500+ tests expected based on STATE.md mentioning 572)
    - All integration tests pass
    - No SIGSEGV or signal 11 errors
    - Test timeout is reasonable (under 5 minutes total)

    Document any failing tests in SUMMARY.md.
  </how-to-verify>
  <resume-signal>
    Type "approved" if all tests pass, or list failing tests for further diagnosis.
  </resume-signal>
</task>

</tasks>

<verification>
After checkpoint approval:
1. Test execution logs saved to test_output_*.txt
2. All tests pass or failures are documented
3. TEST-05 and TEST-06 requirements are validated
</verification>

<success_criteria>
- TEST-05: All 572 lib tests pass (or updated count based on actual test suite)
- TEST-06: All integration tests pass
- Zero SIGSEGV crashes during test execution
- Tests complete without timeout
</success_criteria>

<output>
After completion, create `.planning/phases/21-test-health-and-performance-validation/21-05-SUMMARY.md` with full test results.
</output>
